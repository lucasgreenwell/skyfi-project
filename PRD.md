# Product Requirements Document (PRD)

## 1. Document Purpose

This document outlines the requirements, functional specifications, user stories, and technical architecture for the Satellite Image Vessel Identification and Reporting Application. The goal is to build a fast, simple-to-use Next.js application with a Supabase backend that leverages NLP (via Gemini) and self-hosted Huggingface models for vessel detection, classification, and structured reporting.

## 2. Overview

The application enables users to upload and query satellite imagery, automatically detect and classify vessels, and generate consistent, structured reports. Users interact using natural language inputs that are translated into structured queries. The system overlays vessel identification on images with hover-enabled details, and (in the future) may integrate AIS data to flag vessels without active beacons.

## 3. Goals and Objectives

- **Simplified User Experience:**  
  Provide an intuitive, drag-and-drop interface for uploading satellite images in multiple formats and querying the image database via natural language.

- **Accurate Vessel Detection & Classification:**  
  Automatically detect vessels in satellite images, label them with basic classification, and display rich information on hover (e.g., ship type, flag, port of origin, country of origin).

- **Structured Reporting:**  
  Generate uniform output that includes a set of annotated images along with a text report produced by an LLM, ensuring consistency across diverse satellite data inputs.

- **Efficient System Architecture:**  
  Leverage Next.js with Supabase for core functionality, with NLP handled via Gemini for natural language processing and structured query/report generation. Self-hosting Huggingface models will power vessel detection and classification.

## 4. Scope

### In-Scope Features

- **Image Upload & Drag-Drop Interface:**
  - Support for GeoTIFF, JPEG/JPG, HDF, and PNG formats.
  - Simple drag-and-drop functionality with quick feedback.

- **Natural Language Query Input:**
  - A single input field where users can type natural language queries (e.g., “show me all the vessels in [area of interest] and classify them”).
  - Conversion of natural language into structured queries to search an existing satellite image database.

- **Vessel Detection and Classification:**
  - Automatic detection of vessels within uploaded or queried images.
  - Labeling of detected vessels on the image.
  - On-hover display of detailed vessel information (e.g., ship type, and later, additional attributes like ship flag, port of origin, country of origin).

- **Structured Reporting:**
  - A report output that includes:
    - A set of images (with vessel annotations) returned by the query.
    - A text report generated by the LLM (using Gemini) following a consistent, structured format.

- **System Architecture & Data Flow:**
  - Frontend (Next.js) handling user interactions and basic image processing.
  - API layer (Next.js API routes) for interactions with external services (e.g., Gemini LLM and Huggingface-hosted vessel detection models).
  - Supabase as the primary database for storing and querying satellite images and metadata.

### Out-of-Scope Features (for now)

- Detailed AIS data integration (though the PRD leaves room for overlay/sidebar integration once defined).
- Specific classification schemes for vessel details – to be determined in a later phase.
- External service dependencies beyond what has been specified.

## 5. Functional Requirements

### 5.1 Image Upload Module
- **Supported File Types:** GeoTIFF, JPEG/JPG, HDF, PNG.
- **User Interaction:**  
  - Drag-and-drop area on the main page.
  - Instant feedback on file acceptance.
- **Processing:**  
  - Frontend handles file validation and preliminary image preview.
  - Uploaded images are stored in Supabase with associated metadata.

### 5.2 Natural Language Query Interface
- **Input Method:**  
  - A text input box for natural language queries.
- **Processing Flow:**  
  - The input is sent to a Next.js API endpoint.
  - Gemini is used to convert the natural language query into a structured query.
  - The structured query is executed against the Supabase-stored satellite image database.
- **Example Query:**  
  - “Show me all the vessels in [specific area] and classify them.”

### 5.3 Vessel Detection and Classification Module
- **Detection:**  
  - Satellite images (uploaded or queried) are processed using self-hosted Huggingface models.
  - The model detects vessel locations and outputs bounding boxes.
- **Classification:**  
  - Each detected vessel is labeled with basic classification data.
  - On hover, the UI displays additional vessel details (e.g., ship type, and when available, further details like flag, port, etc.).
- **UI Interaction:**  
  - Annotated images where hovering over vessel labels reveals the extra information.

### 5.4 Structured Reporting Module
- **Output Components:**  
  - **Images:** Annotated images showing vessel detections.
  - **Text Report:** A narrative report generated by Gemini based on the query results.
- **Report Characteristics:**  
  - Consistent structure and format regardless of satellite image source or resolution.
  - Delivered on-screen and available for download if needed.

### 5.5 API Layer & Integration
- **API Responsibilities:**  
  - Handling communication with Gemini for NLP tasks (query parsing and text report generation).
  - Managing calls to Huggingface-hosted models for vessel detection and classification.
- **Data Flow:**  
  - UI interactions trigger API calls.
  - API layer processes inputs, communicates with external services as needed, and returns structured outputs to the frontend.
- **Error Handling:**  
  - Graceful error messages for failed queries or processing steps.
  - Fallbacks for temporary service unavailability.

## 6. Non-Functional Requirements

- **Performance:**
  - Fast image processing and query response times.
  - Minimal latency in the drag-drop upload and report generation.
- **Usability:**
  - Clean and simple UI with a focus on ease of use.
  - Responsive design for various screen sizes.
- **Reliability:**
  - Consistent output across diverse satellite image types and resolutions.
- **Scalability:**
  - Modular architecture to support future enhancements (e.g., detailed AIS data integration).
- **Security:**
  - Secure file uploads and data storage using Supabase’s security features.
  - Secure API endpoints for external communications.

## 7. User Stories

### 7.1 As a Satellite Image Analyst
- **Story:**  
  "As a Satellite Image Analyst, I want to drag-and-drop satellite images (GeoTIFF, JPEG/JPG, HDF, PNG) into the application so that I can quickly upload and analyze data without any technical hassle."
- **Acceptance Criteria:**
  - The system accepts the specified file formats.
  - Users receive immediate visual feedback upon file drop.

### 7.2 As a Mission Planner
- **Story:**  
  "As a Mission Planner, I want to type a natural language query (e.g., 'show me all the vessels in [area] and classify them') so that the system can convert my request into a structured query and retrieve relevant satellite images and vessel data."
- **Acceptance Criteria:**
  - The application correctly translates natural language into structured queries.
  - Relevant images are retrieved and displayed based on the query.

### 7.3 As a Vessel Monitoring Officer
- **Story:**  
  "As a Vessel Monitoring Officer, I want to see vessels automatically detected and classified on satellite images so that I can quickly identify their positions and get detailed information by hovering over them."
- **Acceptance Criteria:**
  - Vessels are detected and annotated on the image.
  - On-hover details display relevant classification data (ship type, flag, port of origin, etc.).

### 7.4 As an Intelligence Analyst
- **Story:**  
  "As an Intelligence Analyst, I want a structured report that includes annotated images and a consistent text summary of the findings so that I can easily review and archive the results."
- **Acceptance Criteria:**
  - The system generates a report that includes both visual (annotated images) and textual outputs.
  - The text report follows a uniform format regardless of the input source.

## 8. Technical Architecture

### Frontend
- **Framework:** Next.js
- **Responsibilities:**
  - Handle drag-and-drop image uploads.
  - Provide the natural language query interface.
  - Render annotated images and reports.
  - Directly process UI interactions that do not require external service calls.

### Backend/API Layer
- **Framework:** Next.js API routes
- **Responsibilities:**
  - Handle API calls to Gemini for natural language processing (both query conversion and report generation).
  - Manage requests to self-hosted Huggingface models for vessel detection and classification.
  - Interface with Supabase for data storage and query execution.

### Database
- **Platform:** Supabase
- **Responsibilities:**
  - Store satellite images and metadata.
  - Serve as the data source for query operations.

### External Services
- **Gemini:**  
  - NLP tasks for converting natural language queries to structured queries.
  - Generating a text report based on the analysis.
- **Huggingface (Self-Hosted):**  
  - Vessel detection and classification models processing satellite imagery.

## 9. Future Considerations

- **AIS Data Integration:**  
  - Although not detailed in this PRD, future iterations may include overlaying AIS data (e.g., determining if the AIS beacon is off, identifying dark ships) via an overlay or sidebar.
- **Advanced Classification Schemes:**  
  - The system is designed to allow for richer vessel classification details (e.g., ship flag, port of origin) as requirements are finalized.

## 10. Dependencies and Risks

- **Dependencies:**
  - Availability and performance of Gemini for NLP tasks.
  - Reliability of self-hosted Huggingface models.
  - Supabase uptime and data integrity.
- **Risks:**
  - Latency or downtime in external NLP/model services affecting overall performance.
  - Potential challenges in achieving consistent structured reporting across diverse satellite image inputs.

